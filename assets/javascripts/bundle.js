!function(t){function e(n){if(r[n])return r[n].exports;var o=r[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,e),o.l=!0,o.exports}var r={};e.m=t,e.c=r,e.d=function(t,r,n){e.o(t,r)||Object.defineProperty(t,r,{configurable:!1,enumerable:!0,get:n})},e.n=function(t){var r=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(r,"a",r),r},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=0)}([function(t,e,r){r(1)},function(t,e,r){"use strict";var n,o,a,s,c,i,u,l,m,d,p,f,g,h,v,w,b,y,I,S,k,j,B,x,_,C,G,O,P,T,E,F,N,M,z,U,D,J,L,q,A,Q,R,W,H;z="https://xlv7zi96k3.execute-api.ap-northeast-1.amazonaws.com/prod/",F=0,B=0,s="",c="",i=0,p=!1,H=null,O=null,P=!1,T=null,M=!1,f=0,a=[],b=1,y="setting.comment",I="setting.count",j="setting.spgift",k="setting.paidgift",S="setting.freegift",U=!1,D=!1,A=!1,q=!1,J=!1,m=function(){return $("#message").html(""),f=0},L=function(t){return $("#message").html(t)},W=function(){return $("#room_url").val()},v=function(){return z+W()},u=function(){return F=0,B=0,s="",c="",i=0,a=[]},E=function(t){var e,r,n;return n=new DOMParser,e=n.parseFromString(t,"text/html"),e.getElementById("js-live-data")?(r=JSON.parse(e.getElementById("js-live-data").getAttribute("data-json")),F=parseInt(r.room_id),B=parseInt(r.live_id),s=r.broadcast_key,c=r.broadcast_host,i=r.broadcast_port,!0):void L("ライブが終了しています")},Q=function(){var t;return m(),t=v(),$.ajax({type:"GET",url:t,success:function(t){var e;return P=!1,e=E(t),e?d():void u()},error:function(t,e,r){return P=!1,L("ページがみつかりません")}})},g=function(){return null!==H&&(H.send("QUIT"),H.close(),H=null,clearInterval(O)),p=!1,$("#connectButton").html("接続"),$("#connectButton").removeClass("gray"),$("#room_url").prop("disabled",!1)},_=function(){return p?(g(),P=!1):""===W()?(L("URLを入力してください。"),void(P=!1)):Q()},d=function(){return l(),a=[],H&&g(),H=new WebSocket("wss://"+c+":"+i),H.onopen=function(){return H.send("SUB\t"+s),H.onmessage=C,p=!0,$("#connectButton").html("切断"),$("#connectButton").addClass("gray"),$("#room_url").prop("disabled",!0)},O=setInterval(function(){return H&&H.readyState===H.OPEN?H.send("PING"):g()},3e4)},C=function(t){var e,r,s,c,i,u;if(t.isTrusted&&(i=t.data.split("\t"),!(i.length<2||"MSG"!==i[0])&&(s=i[2])&&(r=JSON.parse(s),1===(u=parseInt(r.t))||2===u)))return c=new Date,e={type:u,json:r,time:c.toLocaleString()},a.push(e),1===u&&(n(e),f+=1,$("#comment-count").html(f)),2===u&&o(e),M?T.cache():void 0},n=function(t){var e,r,n,o,a;if(o=t.json.ac,r=t.json.cm,e=t.json.av,r.match(/^[1-5]?[0-9]$/)){if(!D)return}else if(!U)return;return n=b++,a="<tr> <td class='user-column'> <img class='avatar' id='user-img-"+n+"' src='https://image.showroom-live.com/showroom-prod/image/avatar/"+e+".png'> "+o+" </td> <td class='date-column'>"+t.time+"</td> <td>"+r+"</td> </tr>",$("#main-tbody").prepend(a)},o=function(t){var e,r,n,o,a,s,c,i;if(r=t.json.g,n=parseInt(t.json.gt),o=parseInt(t.json.h),c=t.json.n,s=t.json.ac,e=t.json.av,1===o){if(!A)return}else if(1===n){if(!q)return}else if(!J)return;return a=b++,i="<tr> <td class='user-column'> <img class='avatar' id='user-img-"+a+"' src='https://image.showroom-live.com/showroom-prod/image/avatar/"+e+".png'> "+s+" </td> <td class='date-column'>"+t.time+"</td> <td> <img class='gift' id='gift-img-"+a+"' src='https://image.showroom-live.com/showroom-prod/assets/img/gift/"+r+"_s.png'> <span class='gift-num'>x"+c+"</span> </td> </tr>",$("#main-tbody").prepend(i)},l=function(){return $("#main-tbody").html("")},G=function(){return M?h():R()},$("#room_url").keypress(function(t){if(13===t.which)return $("#connectButton").click()}),R=function(){return T.cache(),T.trigger(),$("#searchButton").html("ON"),$("#searchButton").removeClass("gray"),M=!0,$("#filterText").prop("disabled",!1)},h=function(){return M=!1,$("#searchButton").html("OFF"),$("#searchButton").addClass("gray"),$("#filterText").prop("disabled",!0),T.reset(),T.search("")},x=function(){var t;if(t={},t[y]=localStorage.getItem(y),t[I]=localStorage.getItem(I),t[j]=localStorage.getItem(j),t[S]=localStorage.getItem(S),t[y]||(t[y]="true"),"true"===t[y]&&(U=!0,$("#showComment").prop("checked",!0)),"true"===t[I]&&(D=!0,$("#showCountComment").prop("checked",!0)),t[j]||(t[j]="true"),"true"===t[j]&&(A=!0,$("#showSPGift").prop("checked",!0)),t[k]||(t[k]="true"),"true"===t[k]&&(q=!0,$("#showPaidGift").prop("checked",!0)),"true"===t[S])return J=!0,$("#showFreeGift").prop("checked",!0)},N=function(){return U=$("#showComment").prop("checked"),D=$("#showCountComment").prop("checked"),A=$("#showSPGift").prop("checked"),q=$("#showPaidGift").prop("checked"),J=$("#showFreeGift").prop("checked"),localStorage.setItem(y,U),localStorage.setItem(I,D),localStorage.setItem(j,A),localStorage.setItem(k,q),localStorage.setItem(S,J)},w=function(){if(N(),l(),a.forEach(function(t){if(1===t.type&&n(t),2===t.type)return o(t)}),M)return T.cache()},$(function(){return $("#connectButton").click(function(){return!P&&(P=!0,_())}),$("table").resizableColumns(),T=$("#filterText").quicksearch("table tbody tr"),$("#searchButton").click(function(){return G()}),$("#setting-open").leanModal({closeButton:".modal-close"}),x(),$("input.gift-setting").change(w)})}]);